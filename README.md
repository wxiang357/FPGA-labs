# FPGA-labs

该项目整理一些FPGA实验，主要用于交流学习。

- [FPGA-labs](#fpga-labs)
  - [1	FPGA基础](#1fpga基础)
    - [1.1	按键去抖动以及按键阵列检测](#11按键去抖动以及按键阵列检测)
    - [1.2	多路分频器设计](#12多路分频器设计)
    - [1.3	串口收发](#13串口收发)
    - [1.4	spi flash](#14spi-flash)
    - [1.5	sd卡读写](#15sd卡读写)
    - [1.6	VGA控制器](#16vga控制器)
    - [1.7	HDMI](#17hdmi)
    - [1.8	网口开发](#18网口开发)
    - [1.9	简单的图像处理](#19简单的图像处理)
  - [2	SoC基础](#2soc基础)
    - [2.1	嵌入式最小系统](#21嵌入式最小系统)
    - [2.2	MIO/EMIO](#22mioemio)
    - [2.3	自定义IP](#23自定义ip)
    - [2.4	程序固化](#24程序固化)
    - [2.5	XADC实验](#25xadc实验)
    - [2.6	Zynq PL中断请求](#26zynq-pl中断请求)
    - [2.7	GPIO中断](#27gpio中断)
    - [2.8	定时器中断](#28定时器中断)
    - [2.9	串口中断](#29串口中断)
    - [2.10	User GPIO](#210user-gpio)
    - [2.11	软硬件调试技巧](#211软硬件调试技巧)
    - [2.12	AXI Lite总线](#212axi-lite总线)
  - [3	DMA/VDMA](#3dmavdma)
    - [3.1	DMA Loop环路测试](#31dma-loop环路测试)
    - [3.2	PL发送数据到PS](#32pl发送数据到ps)
    - [3.3	基于DMA的摄像头采集系统](#33基于dma的摄像头采集系统)
    - [3.4	基于VDMA的摄像头采集系统](#34基于vdma的摄像头采集系统)
    - [3.5	DMA LWIP以太网传输](#35dma-lwip以太网传输)
    - [3.6	通过BRAM进行PS与PL的数据交互](#36通过bram进行ps与pl的数据交互)
  - [4	Linux系统开发（嵌入式开发）](#4linux系统开发嵌入式开发)
    - [4.1	构建硬件运行环境](#41构建硬件运行环境)
    - [4.2	构建软件运行环境](#42构建软件运行环境)
    - [4.3	开发字符设备驱动程序](#43开发字符设备驱动程序)
    - [4.4	运行Qt程序](#44运行qt程序)
  - [5	HLS入门](#5hls入门)
    - [5.1	基于HLS的流水灯](#51基于hls的流水灯)
    - [5.2	简单算法的实现](#52简单算法的实现)
    - [5.3	图像处理实例](#53图像处理实例)
    - [5.4 网口传输的视频图像处理系统](#54-网口传输的视频图像处理系统)
    - [5.5 神经网络搭建](#55-神经网络搭建)
  - [6	MIG控制器](#6mig控制器)
    - [6.1	DDR读写测试](#61ddr读写测试)
    - [6.2	DDR缓存图像数据](#62ddr缓存图像数据)
  - [7	PCIe开发](#7pcie开发)
    - [7.1	XAPP1052](#71xapp1052)
    - [7.2	XDMA基础测试](#72xdma基础测试)
    - [7.3	XDMA读写BAR和BRAM](#73xdma读写bar和bram)
    - [7.4	XDMA图像传输](#74xdma图像传输)

## 1	FPGA基础

### 1.1	按键去抖动以及按键阵列检测

学习按键去抖动的方法，进一步应用到4x4键盘阵列的检测和读取。动态数码管扫描也是类似的方法。

### 1.2	多路分频器设计

学会分频方法，设计任意频率发生器（任意分频）。
学会使用ila抓取上板测试的波形，在上板调试过程中非常有用。

### 1.3	串口收发

实现串口字符的收发.

### 1.4	spi flash

了解spi协议和spi flash读写操作，设计简单的flash控制器，实现flash的擦除、编程、读取等。

### 1.5	sd卡读写

sd卡或tf卡是嵌入式设备重要的存储模块，通过此实验了解sd卡的读写。在次基础上可以读取sd卡中存储的图片等文件，用于显示和图像处理器操作。

### 1.6	VGA控制器

学习VGA时序，并实现VGA显示，包括字符和图片显示。在此基础上设计俄罗斯方块、贪吃蛇等游戏。

### 1.7	HDMI

了解HDMI时序，完成HDMI显示。

### 1.8	网口开发

了解UDP协议，实现简单的网口通信。

### 1.9	简单的图像处理

用Verilog实现简单的图像处理程序，如Sobel边缘检测，推荐使用硬件乘法器IP。


## 2	SoC基础

主要参考米联客《Zynq SoC修炼秘籍》

### 2.1	嵌入式最小系统

包括hello world实验，内存测试等。

### 2.2	MIO/EMIO

PS端的操作。

### 2.3	自定义IP

创建简单的用户IP，学习PS+PL开发思想。

### 2.4	程序固化

学习Zynq启动流程，学习镜像文件的制作。

### 2.5	XADC实验

借助Zynq内嵌的XADC采集内部参数。

### 2.6	Zynq PL中断请求

学习外部中断，通过PL传递中断，在PS端接受并处理。

[S02_CH06](./S02/CH06/)

### 2.7	GPIO中断

配置GPIO中断源。

### 2.8	定时器中断

PS端自己的中断。

### 2.9	串口中断

进一步学习中断。

### 2.10	User GPIO

创建基于AXI接口的IP。

### 2.11	软硬件调试技巧

在Block Design中使用VIO和ILA，学会软硬件联合调试。

### 2.12	AXI Lite总线

通过分析代码了解工作时序。


## 3	DMA/VDMA

### 3.1	DMA Loop环路测试

SDK驱动DMA向DDR发送数据，随后通过DMA读取数据，对比读取和发送的数据是否一致。

[S03_CH01](S03/CH01/)

### 3.2	PL发送数据到PS

接上一个实验，PS端接收。

### 3.3	基于DMA的摄像头采集系统

没有摄像头可以换成本地视频流或图片。

### 3.4	基于VDMA的摄像头采集系统

VDMA主要用于视频流的存取，在图像、视频处理系统中具有重要意义。

### 3.5	DMA LWIP以太网传输

PL通过DMA将数据发送到PS DDR的乒乓缓存中，PS将缓存的数据通过TCP协议发送至PC。

[S03_CH05](./S03/CH05/)

### 3.6	通过BRAM进行PS与PL的数据交互

适用于传输少量，地址不连续，长度不规则的数据。


## 4	Linux系统开发（嵌入式开发）

参考《Zynq SoC修炼秘籍》（2017版不完整）和《Zynq-7000嵌入式系统设计与实现——基于Cortex A9双核处理器和Vivado的设计方法》

### 4.1	构建硬件运行环境

在基本硬件环境的基础上添加用户定制外设的IP。

### 4.2	构建软件运行环境

编译u-boot，kernel，设备树和文件系统。制作启动镜像，从sd卡或flash启动Linux。

### 4.3	开发字符设备驱动程序

除了PS一端的外设之外，用户可以在PL中定制大量不同类型的外设。Linux中没有提供这些外设的驱动，需要自行开发。

### 4.4	运行Qt程序

搭建Qt交叉编译环境，在开发板上运行Qt程序。


## 5	HLS入门

参考ug902和ug871。

### 5.1	基于HLS的流水灯

熟悉HLS的开发流程。

### 5.2	简单算法的实现

通过HLS实现矩阵乘法，FFT等计算密集型算法，体会HLS优化指令对设计的影响。

### 5.3	图像处理实例

通过HLS开发肤色检测或边缘检测等图像处理程序，并搭建完整的软硬件系统。

[S05_CH03](./S05/CH03/)

### 5.4 网口传输的视频图像处理系统

在本地通过OpenCV读取视频或图像，通过socket发送图像数据。在PS端建立TCP server接收数据，通过硬件完成图像处理后在屏幕上显示。

[S05_CH04](./S05/CH04/)

### 5.5 神经网络搭建

通过HLS搭建CNN，进一步体会HLS的设计思想。


## 6	MIG控制器

### 6.1	DDR读写测试

了解MIG控制器的使用。

### 6.2	DDR缓存图像数据

通过DDR缓存图像数据并输出，可以移植到其他工程中。


## 7	PCIe开发

### 7.1	XAPP1052

Xilinx官方的XAPP1052 demo提供了一种古老的PCIe开发方式，可以用来分析学习。

### 7.2	XDMA基础测试

Vivado自带PCIe DMA即XDMA，目前主要使用这种方式。在本例程中测试AXI4读写DDR，AXI-Lite读写BRAM。

### 7.3	XDMA读写BAR和BRAM

进一步了解XDMA的原理。

### 7.4	XDMA图像传输

主机读取本地图像，通过PCIE传送给FPGA，FPGA处理完成后通过PCIE传给主机。


